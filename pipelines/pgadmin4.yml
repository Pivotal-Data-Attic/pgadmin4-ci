resource_types:
- name: concourse-pipeline
  type: docker-image
  source:
    repository: robdimsdale/concourse-pipeline-resource
    tag: latest-final
- name: git-branches
  type: docker-image
  source: {repository: vito/git-branches-resource}

resources:
  - name: pipeline-ci
    type: git
    source:
      uri: https://github.com/greenplum-db/pgadmin4-ci.git
      branch: concourse
  - name: feature-branch-pipeline
    type: concourse-pipeline
    source:
      target: http://192.168.100.4:8080/
      insecure: "true"
      teams:
      - name: main
        username: {{concourse_user}}
        password: {{concourse_pw}}

jobs:
- name: pipeline-tweaker
  plan:
  - aggregate:
    - get: pipeline-ci
    - get: source-branches
  - task: generate-pipeline
    file: pipeline-ci/pipelines/tasks/generate-feature-branch-pipeline.yml
  - put: feature-branch-pipeline
    params:
      pipelines:
      - name: pgadmin-feature-branches
        team: main
        config_file: generated-pipelines/feature-branch-pipeline.yml