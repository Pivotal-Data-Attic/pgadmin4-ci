machine:
  services:
    - docker

checkout:
  post:
    - git submodule sync
    - git submodule update --init

    - cp ./config_local.py ./submodules/master/web/config_local.py
    - cp ./test_config.json ./submodules/master/web/regression/test_config.json

    - cp ./config_local.py ./submodules/plummaster/web/config_local.py
    - cp ./test_config.json ./submodules/plummaster/web/regression/test_config.json

dependencies:
  override:
    - case $CIRCLE_NODE_INDEX in 0) pyenv global 2.7.12 ;; 1) pyenv global 3.1.5 ;; 2) pyenv global 3.2.6 ;; 3) pyenv global 3.5.2 ;; esac:
        parallel: true
    - pip install -r ./submodules/master/requirements_py2.txt

test:
  override:
    - run_tests.sh
