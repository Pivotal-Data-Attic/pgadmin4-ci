machine:
  services:
    - docker

checkout:
  post:
    - git submodule sync
    - git submodule update --init

    - cp ./config_local.py ./submodules/master/web/config_local.py
    - cp ./test_config.json ./submodules/master/web/regression/test_config.json

    - cp ./config_local.py ./submodules/plummaster/web/config_local.py
    - cp ./test_config.json ./submodules/plummaster/web/regression/test_config.json

dependencies:
  pre:
    - ./install_linux_packages.sh
    
test:
  override:
    - ./env_config.sh:
        parallel: true
    - ./run_plummaster_tests.sh:
        parallel: true
    - ./run_master_tests.sh:
        parallel: true
    - ./run_plummaster_on_greenplum_tests.sh
  post:
    - find submodules/ -name screenshots -exec cp -r '{}' $CIRCLE_ARTIFACTS/ ';':
        parallel: true
